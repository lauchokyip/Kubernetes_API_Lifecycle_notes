## Things I found out while working on kubectl

* Main kubectl function starts [here](https://github.com/kubernetes/kubernetes/blob/ea0764452222146c47ec826977f49d7001b0ea8c/staging/src/k8s.io/kubectl/pkg/cmd/cmd.go#L522-L525). This 
is where most of the setup starts branching out. Notice that the `MatchVersionFlags` will wrap around Config Flags using [Delegate design pattern](https://en.wikipedia.org/wiki/Delegation_pattern) to check the version of kubectl and API server before proceed.
* Config flags is very important because it implements [RestClientGetter](https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/cli-runtime/pkg/genericclioptions/config_flags.go#L76) which will given use the function `ToRestConfig()`, `ToDiscoveryClient`, `ToRestMapper`and `ToRawKubeConfigLoader`. It will be added [here](https://github.com/kubernetes/kubernetes/blob/ea0764452222146c47ec826977f49d7001b0ea8c/staging/src/k8s.io/kubectl/pkg/cmd/cmd.go#L522)
* While I am working on a feature to extend `kubectl wait`, I came across 3 very similar types
  * `runtime.Unstructured`
  * `runtime.Object`
  * `unstructured.Unstructured`
* Here are the explanations: 
  * [`runtime.Unstructured`](https://github.com/kubernetes/kubernetes/blob/907d62eac8bdbb8bceea8e3767f6f3b9061a17f5/staging/src/k8s.io/apimachinery/pkg/runtime/interfaces.go#L327-L344) is essentially an interface that defines how an `Unstructured` type should be. It provides some useful method which 
  * [`unstructured.Unstructured`](https://github.com/kubernetes/kubernetes/blob/907d62eac8bdbb8bceea8e3767f6f3b9061a17f5/staging/src/k8s.io/apimachinery/pkg/apis/meta/v1/unstructured/unstructured.go#L48-L50) is a concrete Object that implements `metav1.Object`, `runtime.Unstructure`, and `metav1.ListInterface`. It has some useful function that can be used for example, [`NestedInt64`](https://github.com/kubernetes/kubernetes/blob/907d62eac8bdbb8bceea8e3767f6f3b9061a17f5/staging/src/k8s.io/apimachinery/pkg/apis/meta/v1/unstructured/helpers.go#L116) which will return only Int64 in the whole nested `unstructured.Unstructured`.
  * [`runtime.Object`](https://github.com/kubernetes/kubernetes/blob/907d62eac8bdbb8bceea8e3767f6f3b9061a17f5/staging/src/k8s.io/apimachinery/pkg/runtime/interfaces.go#L299-L302) is an interface that definies how a Kubernetes object should be like. For example, pods, deployments, service are all the implementation of [`runtime.Object`](https://github.com/kubernetes/kubernetes/blob/907d62eac8bdbb8bceea8e3767f6f3b9061a17f5/staging/src/k8s.io/apimachinery/pkg/runtime/interfaces.go#L299-L302)
* The kubectl [`Builder`](https://github.com/kubernetes/kubernetes/blob/907d62eac8bdbb8bceea8e3767f6f3b9061a17f5/staging/src/k8s.io/cli-runtime/pkg/resource/builder.go#L52) uses a [`Visitor`](https://github.com/kubernetes/kubernetes/blob/4af19756bd1e21da288732d33d268f626adf1145/staging/src/k8s.io/cli-runtime/pkg/resource/interfaces.go#L94) interface to walk through all the resources. Usually if we set up a client, we need to call `GET`, `LIST` etc to make a request but it's so find where it is because of the Visitor pattern. I am not really sure if it's using the `Visitor` design pattern but basically what it does is **wrap one Visitor on another visit (kind of like delegate design pattern)** .So far, I have tried two ways, 
```
kubectl get pods
```
```
kubectl get pod [pod name]
```
* The first way will trigger a [`visitBySelector`](https://github.com/kubernetes/kubernetes/blob/4af19756bd1e21da288732d33d268f626adf1145/staging/src/k8s.io/cli-runtime/pkg/resource/builder.go#L875), and the second way will triger a [`visitByName`](https://github.com/kubernetes/kubernetes/blob/4af19756bd1e21da288732d33d268f626adf1145/staging/src/k8s.io/cli-runtime/pkg/resource/builder.go#L1029). [`visitBySelector`](https://github.com/kubernetes/kubernetes/blob/4af19756bd1e21da288732d33d268f626adf1145/staging/src/k8s.io/cli-runtime/pkg/resource/builder.go#L875) is way easier because it just creates a new [`Selector`](https://github.com/kubernetes/kubernetes/blob/4af19756bd1e21da288732d33d268f626adf1145/staging/src/k8s.io/cli-runtime/pkg/resource/builder.go#L914) and the Selector has a [`List`](https://github.com/kubernetes/kubernetes/blob/4af19756bd1e21da288732d33d268f626adf1145/staging/src/k8s.io/cli-runtime/pkg/resource/selector.go#L57) method. But what about [`visitByName`](https://github.com/kubernetes/kubernetes/blob/4af19756bd1e21da288732d33d268f626adf1145/staging/src/k8s.io/cli-runtime/pkg/resource/builder.go#L1029)?? It's actually using a [`NewDecorativeVisitor`](https://github.com/kubernetes/kubernetes/blob/4af19756bd1e21da288732d33d268f626adf1145/staging/src/k8s.io/cli-runtime/pkg/resource/builder.go#L1158) which will eventually call the [`RetrieveLatest`](https://github.com/kubernetes/kubernetes/blob/4af19756bd1e21da288732d33d268f626adf1145/staging/src/k8s.io/cli-runtime/pkg/resource/visitor.go#L668) and then the [`GET`](https://github.com/kubernetes/kubernetes/blob/4af19756bd1e21da288732d33d268f626adf1145/staging/src/k8s.io/cli-runtime/pkg/resource/visitor.go#L673) method
